# Включаем обработку PHP
<IfModule mod_php7.c>
    php_flag display_errors Off
    php_value error_reporting 32767
    php_value error_log /var/log/php_errors.log
</IfModule>

# CORS заголовки для API
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, X-Auth-Token, X-User-Id"
    Header always set Access-Control-Max-Age "86400"
</IfModule>

# Разрешаем OPTIONS запросы для CORS preflight
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>

# Защита от прямого доступа к служебным файлам
<FilesMatch "^(config\.php)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Разрешаем доступ к API файлам
<FilesMatch "\.(php)$">
    Order allow,deny
    Allow from all
</FilesMatch>

# Установка кодировки UTF-8
AddDefaultCharset UTF-8

# Включаем сжатие для JSON
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE text/plain
</IfModule>
